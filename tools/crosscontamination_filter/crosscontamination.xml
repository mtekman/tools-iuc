<tool id="raceid3" name="RaceID3" version="@VERSION@.0">
    <description>Performs RaceID3 analysis
    </description>
    <requirements>
        <requirement type="package" version="3.4.1" >r</requirement>
    </requirements>

    <!-- <version_command><![CDATA[ -->
    <!-- Rscript '$__tool_directory__/scripts/cross_contamination.R' -->
    <!-- ]]></version_command> -->

    <command detect_errors="exit_code"><![CDATA[
    Rscript '$__tool_directory__/scripts/cross_contamination.R' '$crossconf'
    Rscript '$__tool_directory__/scripts/raceid3.R' '$race3conf'
    ]]></command>

    <configfiles>
        <configfile name="userconf"><![CDATA[
                                      # BEGIN USER CONFIG
reader.file = '$input'
reader.header = T

size.barcodes = 192
size.batch = 96

                                      # END USER CONFIG
]]>
        </configfile>
    </configfiles>

    <inputs>
        <param name="input" type="data" format="tsv,tabular" label="Input Table" />
        
        <conditional name="cond_filter" >
            <param name="filter_on" type="select" label="Filter based upon">
                <option value="plateand">Headers have Plate and Batch</option>
                <option value="barcodes">Headers have Barcodes</option>
            </param>

            <when value="plateand" >
                <param name="plate_size" type="integer" min="10" value="192" label="Number of Cells per Plate" />
                <param name="lane_size" type="integer" min="10" value="96" label="Number of Cells per Batch" />
            </when>

            <when value="barcodes" >
                <param name="barc_file" type="data" label="Barcodes file" help="This file should contain all available barcodes without mixing between batches" />
                <param name="lane_size" type="integer" min="10" value="96" label="Number of Cells per Batch" />
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="out_plot" format="png" label="Contamination Plot: ${tool.name} on ${on_string}" />
        <data name="out_table" format_source="input" label="Filtered Table: ${tool.name} on ${on_string}" />
    </outputs>

    <tests>
        <!-- Barcodes test -->
        <test>
        </test>
        <!-- Plate and Lane test -->
        <test>
        </test>
        
    </tests>
</tool>

